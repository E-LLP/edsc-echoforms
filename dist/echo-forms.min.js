/*
 *  echo-forms.js - v1.0.0
 */
(function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b},c=function(a,b){return function(){return a.apply(b,arguments)}};!function(a,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y;return f=function(){function a(a){this.message=a}return a.prototype.check=function(){return console.warn(""+this.constructor.name+" must override check")},a}(),t=function(a){function c(a,b){this.pattern=new RegExp("^"+a+"$"),c.__super__.constructor.call(this,null!=b?b:"Invalid")}return b(c,a),c.prototype.check=function(a){return!a||null!==this.pattern.exec(a)},c}(f),H=function(a){function c(a,b){this.xpath=a,c.__super__.constructor.call(this,null!=b?b:"Invalid")}return b(c,a),c.prototype.check=function(a,b,c){return b.xpath(this.xpath,c)[0]},c}(f),E=function(a){function c(a,b){var d,e,f;null==b&&(b=null),f=a.match(/^(?:[^:]+:)?(.*)$/),this.type=f?f[1]:a,e=function(){switch(this.type){case"double":return"number";case"long":return"integer between -2^63 and 2^63-1";case"int":return"integer between -2,147,483,648 and 2,147,483,647";case"short":return"integer between -32,768 and 32,767";case"datetime":return"date/time with format MM/DD/YYYYTHH:MM:SS";case"boolean":return"true or false";default:return this.type}}.call(this),d=/^[aeiou]/i.test(e)?"an":"a",c.__super__.constructor.call(this,null!=b?b:"Value must be "+d+" "+e)}return b(c,a),c.MIN_SHORT=-Math.pow(2,15),c.MAX_SHORT=Math.pow(2,15)-1,c.MIN_INT=-Math.pow(2,31),c.MAX_INT=Math.pow(2,31)-1,c.MIN_LONG=-Math.pow(2,63),c.MAX_LONG=Math.pow(2,63)-1,c.prototype.check=function(a){if(!a)return!0;switch(this.type){case"string":return!0;case"anyuri":return!0;case"double":return this.checkDouble(a);case"long":return this.checkLong(a);case"int":return this.checkInt(a);case"short":return this.checkShort(a);case"datetime":return this.checkDateTime(a);case"boolean":return this.checkBoolean(a);default:return console.warn("Unable to validate type: ",this.type),!0}},c.prototype._checkIntegerRange=function(a,b,c){var d;return d=Number(c),!isNaN(d)&&d>=a&&b>=d&&-1===c.indexOf(".")},c.prototype.checkDouble=function(a){return!isNaN(Number(a))},c.prototype.checkLong=function(a){return this._checkIntegerRange(c.MIN_LONG,c.MAX_LONG,a)},c.prototype.checkInt=function(a){return this._checkIntegerRange(c.MIN_INT,c.MAX_INT,a)},c.prototype.checkShort=function(a){return this._checkIntegerRange(c.MIN_SHORT,c.MAX_SHORT,a)},c.prototype.checkBoolean=function(a){return"true"===a||"false"===a},c.prototype.checkDateTime=function(a){var b,c,d,e,f,g,h,i,j,k,l,m;return a.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}$/)?(k=a.split("T"),b=k[0],i=k[1],l=function(){var a,c,d,e;for(d=b.split("-"),e=[],a=0,c=d.length;c>a;a++)h=d[a],e.push(parseInt(h,10));return e}(),j=l[0],f=l[1],c=l[2],m=function(){var a,b,c,d;for(c=i.split(":"),d=[],a=0,b=c.length;b>a;a++)h=c[a],d.push(parseInt(h,10));return d}(),d=m[0],e=m[1],g=m[2],f>=1&&12>=f&&c>=1&&31>=c&&24>d&&60>e&&60>g):!1},c}(f),z=function(a){function c(a,b){this.xpath=a,null==b&&(b="Required field"),c.__super__.constructor.call(this,b)}return b(c,a),c.prototype.check=function(a,b,c){return a instanceof Array&&0===a.length&&(a=null),!!a||!b.xpath(this.xpath,c)[0]},c}(f),p=function(a){function c(a,b){this.count=a,null==b&&(b=null),c.__super__.constructor.call(this,null!=b?b:this.buildMessage())}return b(c,a),c.prototype.itemWord=function(){return 1===this.count?"item":"items"},c}(f),r=function(a){function c(){return N=c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.buildMessage=function(){return"At least "+this.count+" "+this.itemWord()+" required"},c}(p),q=function(a){function c(){return O=c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.buildMessage=function(){return"No more than "+this.count+" "+this.itemWord()+" allowed"},c}(p),L=0,g=function(){function b(b,d,e,f){var g,h,i,j,k;for(this.ui=b,this.model=d,this.controlClasses=e,this.resolver=f,this.onChange=c(this.onChange,this),this.changed=c(this.changed,this),this.refExpr=b.attr("ref"),this.id=null!=(j=b.attr("id"))?j:"echoforms-control-"+L++,this.relevantExpr=b.attr("relevant"),this.requiredExpr=b.attr("required"),this.readonlyExpr=b.attr("readonly"),this.label=b.attr("label"),k=b.children("help"),h=0,i=k.length;i>h;h++)g=k[h],this.help=a(g).text();this.loadConstraints(),this.el=this.buildDom(),this.bindEvents()}return b.prototype.loadConstraints=function(){var b,c,d,e,f,g,h,i,j;for(this.constraints=[],this.requiredExpr&&this.constraints.push(new z(this.requiredExpr)),b=this.ui.children("constraints"),i=b.children("constraint"),j=[],g=0,h=i.length;h>g;g++)d=i[g],d=a(d),c=d.children("alert").text(),e=d.children("pattern"),f=d.children("xpath"),e.length>0&&this.constraints.push(new t(e.text(),c)),f.length>0?j.push(this.constraints.push(new H(f.text(),c))):j.push(void 0);return j},b.prototype.ref=function(){return null!=this.refExpr?this.xpath(this.refExpr):this.model},b.prototype.refValue=function(){return null!=this.refExpr?a.trim(this.ref().text()):void 0},b.prototype.inputValue=function(){return console.warn(""+this.constructor.name+" must override inputValue")},b.prototype.loadFromModel=function(){return this.validate()},b.prototype.validate=function(){var a,b;return null!=this.relevantExpr&&this.relevant(!!this.xpath(this.relevantExpr)[0]),null!=this.readonlyExpr&&this.readonly(!!this.xpath(this.readonlyExpr)[0]),b=function(){var b,c,d,e,f;for(d=this.constraints,f=[],b=0,c=d.length;c>b;b++)a=d[b],a.check(null!=(e=this.refValue())?e:this.inputValue(),this.model,this.resolver)||f.push(a.message);return f}.call(this),this.setErrors(b)},b.prototype.saveToModel=function(){},b.prototype.bindEvents=function(){},b.prototype.xpath=function(a){return"["===(null!=a?a.charAt(0):void 0)&&(a="."+a),"true"===a?[!0]:"false"===a?[!1]:this.model.xpath(a,this.resolver)},b.prototype.element=function(){return null!=this.el?this.el:this.el=this.buildDom()},b.prototype.isChanged=function(){return this.refValue()!==this.inputValue()||!this.refExpr},b.prototype.changed=function(){return this.el.trigger("echoforms:modelchange")},b.prototype.relevant=function(a){var b;return null==a?!this.el.hasClass("echoforms-irrelevant"):(b=!!a,b!==this.relevant()?(this.el.toggleClass("echoforms-irrelevant",!b),this.el.toggle(b),this.ref().toggleClass("echoforms-pruned",!b)):void 0)},b.prototype.readonly=function(a){var b;return null==a?this.el.hasClass("echoforms-readonly"):(b=!!a,b!==this.readonly()?(this.el.toggleClass("echoforms-readonly ui-state-disabled",b),this.updateReadonly(b)):void 0)},b.prototype.updateReadonly=function(a){return this.inputs().attr("disabled",a),this.inputs().attr("readonly",a)},b.prototype.onChange=function(){return this.isChanged()?(this.saveToModel(),this.changed()):void 0},b.prototype.buildLabelDom=function(){return null!=this.label?a('<label class="echoforms-control-label" for="'+this.id+'-element">'+this.label+"</label>"):a()},b.prototype.buildHelpDom=function(){var b,c,d,e,f;for(c=a(),f=this.ui.children("help"),d=0,e=f.length;e>d;d++)b=f[d],c=c.add('<label class="echoforms-help" for="'+this.id+'-element">'+a(b).text()+"</label>");return c},b.prototype.buildControlDom=function(){return a('<div id="'+this.id+'" class="echoforms-control echoforms-control-'+this.ui[0].nodeName+'"/>')},b.prototype.buildElementsDom=function(){return a('<div class="echoforms-elements"/>').append(this.buildElementsChildrenDom())},b.prototype.buildErrorsDom=function(){return a('<div class="echoforms-errors"/>')},b.prototype.setErrors=function(b){var c,d,e,f,g;for(d=a(),f=0,g=b.length;g>f;f++)e=b[f],c=a('<div class="echoforms-error"/>'),c.text(e),d=d.add(c);return this.el.find(".echoforms-errors").empty().append(d)},b.prototype.buildElementsChildrenDom=function(){return a()},b.prototype.buildDom=function(){var a;return a=this.buildControlDom(),a.append(this.buildLabelDom()),a.append(this.buildElementsDom()),a.append(this.buildHelpDom()),a.append(this.buildErrorsDom()),a},b}(),F=function(c){function d(a,b,c,e){var f;this.inputType=(null!=(f=a.attr("type"))?f:"string").replace(/^.*:/,"").toLowerCase(),d.__super__.constructor.call(this,a,b,c,e)}return b(d,c),d.prototype.loadConstraints=function(){return d.__super__.loadConstraints.call(this),this.constraints.push(new E(this.inputType))},d.prototype.inputs=function(){return null!=this._inputs?this._inputs:this._inputs=this.el.find(":input")},d.prototype.bindEvents=function(){return this.inputs().bind("click change",this.onChange)},d.prototype.inputValue=function(){return a.trim(this.inputs().val())},d.prototype.saveToModel=function(){return d.__super__.saveToModel.call(this),this.refExpr?this.ref().text(this.inputValue()):void 0},d.prototype.loadFromModel=function(){return d.__super__.loadFromModel.call(this),this.refExpr?this.inputs().val(this.refValue()):void 0},d}(g),o=function(c){function d(){return R=d.__super__.constructor.apply(this,arguments)}return b(d,c),d.selector="input",d.prototype.buildElementsChildrenDom=function(){var b;return b=a('<input id="'+this.id+'-element" type="text" class="echoforms-element-input echoforms-element-input-'+this.inputType+'" autocomplete="off">'),"datetime"===this.inputType&&b.attr("placeholder","MM/DD/YYYYTHH:MM:SS"),b},d}(F),h=function(a){function c(){return S=c.__super__.constructor.apply(this,arguments)}return b(c,a),c.selector="input[type$=boolean]",c.prototype.inputValue=function(){return this.inputs().is(":checked").toString()},c.prototype.loadFromModel=function(){return c.__super__.loadFromModel.call(this),this.refExpr?this.inputs().attr("checked","true"===this.refValue()):void 0},c.prototype.buildElementsChildrenDom=function(){return c.__super__.buildElementsChildrenDom.call(this).attr("type","checkbox")},c}(o),s=function(c){function d(a,b,c,e){this.valueExpr=a.attr("value"),d.__super__.constructor.call(this,a,b,c,e)}return b(d,c),d.selector="output",d.prototype.inputs=function(){return a()},d.prototype.refValue=function(){return this.valueExpr?this.xpath(this.valueExpr)[0]:d.__super__.refValue.call(this)},d.prototype.loadFromModel=function(){return d.__super__.loadFromModel.call(this),this.refExpr||this.valueExpr?this.el.find(".echoforms-elements > p").text(this.refValue()):void 0},d.prototype.buildElementsChildrenDom=function(){return a("<p/>")},d}(F),G=function(c){function d(){return T=d.__super__.constructor.apply(this,arguments)}return b(d,c),d.selector="output[type$=anyURI], output[type$=anyuri]",d.prototype.loadFromModel=function(){var a;return a=this.refValue(),this.refExpr||this.valueExpr?this.el.find(".echoforms-elements > a").text(a).attr("href",a):void 0},d.prototype.buildElementsChildrenDom=function(){return a('<a href="#" />')},d}(s),B=function(c){function d(b,c,e,f){var g,h,i;this.isMultiple="true"===b.attr("multiple"),this.valueElementName=b.attr("valueElementName"),this.items=function(){var c,d,e,f,j;for(e=b.children("item"),j=[],c=0,d=e.length;d>c;c++)g=e[c],f=[a(g).attr("label"),a(g).attr("value")],h=f[0],i=f[1],j.push([null!=h?h:i,i]);return j}(),d.__super__.constructor.call(this,b,c,e,f)}return b(d,c),d.selector="select",d.prototype.refValue=function(){var b,c,e,f,g;if(null!=this.valueElementName&&null!=this.refExpr){for(f=this.ref().children(this.valueElementName),g=[],c=0,e=f.length;e>c;c++)b=f[c],g.push(a(b).text());return g}return d.__super__.refValue.call(this)},d.prototype.saveToModel=function(){var b,c,e,f,g,h,i,j;if(null!=this.valueElementName&&null!=this.refExpr){for(e=this.ref().empty(),b=e[0].nodeName.split(":")[0],i=this.inputValue(),j=[],g=0,h=i.length;h>g;g++)f=i[g],c=a("<"+b+":"+this.valueElementName+"/>").text(f),j.push(e.append(c));return j}return d.__super__.saveToModel.call(this)},d.prototype.loadFromModel=function(){var b,c;return null!=this.valueElementName&&null!=this.refExpr?(c=function(){var c,d,e,f;for(e=this.ref().children(),f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(a(b).text());return f}.call(this),this.isMultiple||(c=c[0]),this.inputs().val(c)):d.__super__.loadFromModel.call(this)},d.prototype.inputValue=function(){var a;return a=this.inputs().val(),null==this.valueElementName||a instanceof Array||(a=null!=a?[a]:[]),a},d.prototype.isChanged=function(){return this.refValue()!==this.inputValue()||!this.refExpr},d.prototype.buildElementsChildrenDom=function(){var b,c,d,e,f,g,h,i;for(b=a('<select id="'+this.id+'-element" class="echoforms-element-select" autocomplete="off"/>'),this.isMultiple?(b.addClass("echoforms-element-select-multiple"),b.attr("multiple","multiple")):b.append('<option value=""> -- Select a value -- </option>'),this.isOpen&&b.addClass("echoforms-element-select-open"),g=this.items,i=[],e=0,f=g.length;f>e;e++)h=g[e],c=h[0],d=h[1],i.push(b.append('<option value="'+d+'">'+c+"</option>"));return i},d}(F),u=function(a){function c(a,b,d,e){this.start=a.attr("start"),this.end=a.attr("end"),this.step=a.attr("step"),c.__super__.constructor.call(this,a,b,d,e)}return b(c,a),c.selector="range",c}(o),A=function(a){function c(){return U=c.__super__.constructor.apply(this,arguments)}return b(c,a),c.selector="secret",c.prototype.buildElementsChildrenDom=function(){return c.__super__.buildElementsChildrenDom.call(this).attr("type","password")},c}(o),D=function(c){function d(){return V=d.__super__.constructor.apply(this,arguments)}return b(d,c),d.selector="textarea",d.prototype.buildElementsChildrenDom=function(){return a('<textarea id="'+this.id+'-element" class="echoforms-element-textarea" autocomplete="off"/>')},d}(F),n=function(c){function d(){return W=d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.inputs=function(){return a()},d.prototype.loadFromModel=function(){var a,b,c,e,f;for(d.__super__.loadFromModel.call(this),e=this.controls,f=[],b=0,c=e.length;c>b;b++)a=e[b],f.push(a.loadFromModel());return f},d.prototype.buildDom=function(){var b,c,e,f,g,h,i,j,k,l,m,n,o,p,q;for(j=d.__super__.buildDom.apply(this,arguments),e=this.ref(),k=this.ui,f=a(),this.controls=h=[],p=k.children(),l=0,n=p.length;n>l;l++)if(c=p[l],"help"!==c.nodeName){for(i=!1,q=this.controlClasses,m=0,o=q.length;o>m;m++)if(b=q[m],a(c).is(b.selector)){g=new b(a(c),e,this.controlClasses,this.resolver),h.push(g),f=f.add(g.el),i=!0;break}i||console.log("No class available for element:",c)}return j.find(".echoforms-elements").replaceWith(a('<div class="echoforms-children"/>').append(f)),j},d}(g),l=function(a){function c(a,b,d,e){a.attr("ref",b.children()[0].nodeName),c.__super__.constructor.call(this,a,b,d,e),this.loadFromModel()}return b(c,a),c.prototype.bindEvents=function(){var a=this;return this.el.on("echoforms:modelchange",".echoforms-control",function(){return a.loadFromModel()})},c}(n),m=function(a){function c(){return X=c.__super__.constructor.apply(this,arguments)}return b(c,a),c.selector="group",c}(n),x=function(a){function c(){return Y=c.__super__.constructor.apply(this,arguments)}return b(c,a),c}(n),y=function(c){function d(){return P=d.__super__.constructor.apply(this,arguments)}return b(d,c),d.selector="template",d.prototype.buildDom=function(){return a()},d.prototype.loadFromModel=function(){},d}(n),w=function(a){function c(a,b,d,e){this.minItems=a.attr("minItems"),this.minItems&&(this.minItems=parseInt(this.minItems,10)),this.maxItems=a.attr("maxItems"),this.maxItems&&(this.maxItems=parseInt(this.maxItems,10)),c.__super__.constructor.call(this,a,b,d,e)}return b(c,a),c.selector="repeat",c.prototype.loadConstraints=function(){return c.__super__.loadConstraints.call(this),null!=this.minItems&&this.constraints.push(new r(this.minItems)),null!=this.maxItems?this.constraints.push(new q(this.maxItems)):void 0},c}(n),v=function(a){function c(a,b,d,e){this.idref=a.attr("idref"),c.__super__.constructor.call(this,a,b,d,e)}return b(c,a),c}(g),i=function(a){function c(){return Q=c.__super__.constructor.apply(this,arguments)}return b(c,a),c.selector="controlref",c}(v),C=function(c){function d(b){var c,d,e;this.isOpen="true"===b.attr("open"),this.isMultiple="true"===b.attr("multiple"),this.valueElementName=b.attr("valueElementName"),this.items=function(){var f,g,h,i,j;for(h=b.children("item"),j=[],f=0,g=h.length;g>f;f++)c=h[f],i=[a(c).attr("label"),a(c).attr("value")],d=i[0],e=i[1],j.push([null!=d?d:e,e]);return j}()}return b(d,c),d.selector="selectref",d}(v),J=[h,o,G,s,B,u,A,D,m,w,y,i,C],M="echoform",K={controls:[]},I=function(){function a(a){this.resolve=c(this.resolve,this);var b,d,e,f,g,h;for(f={},e=/\sxmlns(?::(\w+))?=\"([^\"]+)\"/g,b=e.exec(a);null!=b;)d=null!=(h=b[1])?h:" default ",g=b[2],f[d]=g,b=e.exec(a);f.xs="http://www.w3.org/2001/XMLSchema",f.echoforms="http://echo.nasa.gov/v9/echoforms",this.namespaces=f}return a.prototype.resolve=function(a){var b;return null==a&&(a=" default "),b=this.namespaces[a],b||(console.log("Bad prefix: "+a+".  Ignoring."),a=" default "),b},a}(),j=function(){function b(b,c){var e,f,g;this.controlClasses=c,this.resolver=new I(b).resolve,e=a(a.parseXML(b)),this.model=f=e.xpath("//echoforms:form/echoforms:model/echoforms:instance",this.resolver),this.ui=g=e.xpath("//echoforms:form/echoforms:ui",this.resolver),d.ui=g,d.model=f,d.resolver=this.resolver,this.control=new l(g,f,this.controlClasses,this.resolver)}return b.uniqueId=0,b.prototype.element=function(){return this.control.element()},b}(),k=function(){function b(b,c){var d;this.root=b,this.options=a.extend({},K,c),this.form=null!=(d=this.options.form)?d:b.find(".echoforms-xml").text(),this.controlClasses=this.options.controls.concat(J),this._defaults=K,this._name=M,this.root=b=a(b),this.builder=new j(this.form,this.controlClasses),b.append(this.builder.element())}return b.inputTimeout=null,b}(),a.fn[M]=function(b){return this.each(function(){}),a.data(this,"echoformsInterface")?void 0:a.data(this,"echoformsInterface",new k(this,b))},a(e).ready(function(){})}(jQuery,window,document)}).call(this);